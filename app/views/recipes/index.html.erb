<% content_for :title, "Recipe Finder" %>

<div class="min-h-screen bg-stone-100">
  <!-- Search Header -->
  <div class="bg-white shadow-sm border-b">
    <div class="container mx-auto px-4 py-6">
      <div class="bg-orange-500 rounded-lg p-6 mb-6">
        <h1 class="text-2xl font-bold text-white mb-4">Find Your Perfect Recipe</h1>
        <%= form_with url: recipes_path, method: :get, local: true, class: "space-y-4" do |form| %>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <%= form.label :ingredients, "What ingredients do you have?", class: "block text-sm font-medium text-white mb-2" %>
              <%= form.text_field :ingredients,
                                  value: @search_query,
                                  placeholder: "e.g., eggs, flour, chocolate",
                                  class: "w-full px-4 py-3 border-0 rounded-md text-stone-900 placeholder-stone-500 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-orange-500" %>
            </div>
            <div>
              <%= form.label :max_time, "Maximum time (minutes)", class: "block text-sm font-medium text-white mb-2" %>
              <%= form.number_field :max_time,
                                    value: @max_time,
                                    placeholder: "e.g., 30, 60, 120",
                                    min: 1,
                                    step: 1,
                                    class: "w-full px-4 py-3 border-0 rounded-md text-stone-900 placeholder-stone-500 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-orange-500" %>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <%= form.submit "Find Recipes", class: "bg-white text-orange-600 px-8 py-3 rounded-md font-semibold hover:bg-stone-100 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-orange-500" %>
            <% if @search_query.present? || @max_time.present? %>
              <%= link_to "Show All Recipes", recipes_path, class: "text-white hover:text-stone-200 underline text-sm" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col items-center gap-4">
      <!-- Search Results Summary -->
      <% if @search_query.present? || @max_time.present? %>
        <p class="text-stone-400 text-lg"><em>Found <%= @total_count %> matching recipes</em></p>
      <% end %>
      <!-- Recipe Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 gap-y-12">
        <% @recipes.each do |recipe| %>
          <%= render 'recipe', recipe: recipe %>
        <% end %>
      </div>
      
      <!-- Pagination Controls -->
      <% if @pagy.pages > 1 %>
        <div class="mt-8 flex justify-center">
          <div class="flex items-center space-x-2">
            <% if @pagy.prev %>
              <%= link_to "← Previous", url_for(page: @pagy.prev, ingredients: @search_query, max_time: @max_time), 
                          class: "px-4 py-2 bg-white border border-stone-300 rounded-md text-stone-700 hover:bg-stone-50 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2" %>
            <% end %>
            
            <span class="px-4 py-2 text-stone-600">
              Page <%= @pagy.page %> of <%= @pagy.pages %>
            </span>
            
            <% if @pagy.next %>
              <%= link_to "Next →", url_for(page: @pagy.next, ingredients: @search_query, max_time: @max_time), 
                          class: "px-4 py-2 bg-white border border-stone-300 rounded-md text-stone-700 hover:bg-stone-50 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<%= link_to "New recipe", new_recipe_path, class: "fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
